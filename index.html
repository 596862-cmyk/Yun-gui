<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BNIé›²è²´åˆ†æœƒ - æ–°æ‰‹æ‘ä»»å‹™ç³»çµ± (åµéŒ¯ç‰ˆ)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* CSS æ¨£å¼ç¶­æŒä¸è®Š */
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Noto Sans TC', sans-serif; }
        .task-card { transition: all 0.3s ease; }
        .task-card:hover { transform: translateY(-2px); box-shadow: 0 8px 25px rgba(0,0,0,0.15); }
        .completed { background: linear-gradient(135deg, #10b981, #059669); }
        .in-progress { background: linear-gradient(135deg, #f59e0b, #d97706); }
        .not-started { background: linear-gradient(135deg, #6366f1, #4f46e5); }
        .progress-ring { transform: rotate(-90deg); }
        .progress-ring-circle { transition: stroke-dashoffset 0.35s; }
        .category-filter { transition: all 0.3s ease; }
        .category-filter.active { background: linear-gradient(135deg, #8b5cf6, #7c3aed); transform: scale(1.05); }
        .spinner { border-color: transparent; border-top-color: white; }
        [hidden] { display: none !important; }
        #debug-textarea { background-color: rgba(0,0,0,0.1); border: 1px solid rgba(255,255,255,0.2); color: white; font-family: monospace; }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-900 via-indigo-900 to-purple-900 min-h-screen">
    
    <div id="loginContainer" class="container mx-auto px-4 py-8 flex flex-col items-center justify-center min-h-screen">
        <div class="bg-white/10 backdrop-blur-lg rounded-2xl p-8 border border-white/20 w-full max-w-md text-center mb-8"><h1 class="text-3xl font-bold text-white mb-2">BNI æ–°æ‰‹æ‘ä»»å‹™ç³»çµ±</h1><p class="text-blue-200 mb-6">è«‹è¼¸å…¥æ‚¨çš„å§“åç™»å…¥ (å°å¸«è«‹åŠ å¡«å¯†ç¢¼)</p><input type="text" id="nameInput" placeholder="è«‹è¼¸å…¥å§“å" class="w-full bg-white/10 text-white placeholder-blue-300 rounded-lg px-4 py-3 border border-white/20 focus:outline-none focus:ring-2 focus:ring-blue-400 transition-all mb-4 text-lg"><input type="password" id="passwordInput" placeholder="å°å¸«è«‹è¼¸å…¥å¯†ç¢¼ (å°ç”Ÿå…å¡«)" class="w-full bg-white/10 text-white placeholder-blue-300 rounded-lg px-4 py-3 border border-white/20 focus:outline-none focus:ring-2 focus:ring-blue-400 transition-all mb-4 text-lg"><button id="loginBtn" class="w-full bg-gradient-to-r from-blue-600 to-purple-600 text-white px-6 py-3 rounded-lg font-semibold hover:from-blue-700 hover:to-purple-700 transition-all text-lg">ç™»å…¥</button><p id="loginMessage" class="text-red-400 mt-4 h-4"></p></div>
        <div class="bg-white/10 backdrop-blur-lg rounded-2xl p-6 border border-white/20 w-full max-w-md"><h3 class="text-xl font-semibold text-white mb-4 text-center">ğŸ† å°ç”Ÿé€²åº¦æ’è¡Œæ¦œ</h3><div id="leaderboardContainer" class="space-y-3"><p id="leaderboardLoading" class="text-blue-200 text-center">æ’è¡Œæ¦œè¼‰å…¥ä¸­...</p></div></div>
    </div>
    <div id="mentorContainer" class="container mx-auto px-4 py-8" hidden><div class="flex justify-between items-center mb-6"><p id="mentorWelcomeMessage" class="text-white text-lg"></p><button id="mentorLogoutBtn" class="bg-red-600/50 hover:bg-red-600/80 text-white rounded-lg px-4 py-2 border border-red-400/50 transition-all">ç™»å‡º</button></div><div class="bg-white/10 backdrop-blur-lg rounded-2xl p-6 mb-8 border border-white/20"><h2 class="text-2xl font-semibold text-white mb-4">å°å¸«ç®¡ç†å¾Œå°</h2><div class="mb-6"><h3 class="text-lg font-semibold text-white mb-2">æ–°å¢å°ç”Ÿ</h3><div class="flex gap-4"><input type="text" id="newMenteeNameInput" placeholder="è«‹è¼¸å…¥æ–°å°ç”Ÿå§“å" class="flex-grow bg-white/10 text-white placeholder-blue-300 rounded-lg px-4 py-2 border border-white/20 focus:outline-none focus:ring-2 focus:ring-blue-400 transition-all"><button id="addMenteeBtn" class="bg-green-600 hover:bg-green-700 text-white rounded-lg px-5 py-2 font-semibold transition-all">æ–°å¢</button></div><p id="mentorActionMessage" class="text-green-300 mt-2 h-4"></p></div><div><h3 class="text-lg font-semibold text-white mb-2">å°ç”Ÿåˆ—è¡¨ (é»æ“Šå¯æŸ¥çœ‹/ä¿®æ”¹é€²åº¦)</h3><div id="menteeListContainer" class="space-y-2"></div></div></div></div>
    <div id="taskAppContainer" class="container mx-auto px-4 py-8" hidden><div class="flex justify-between items-center mb-6"><p id="taskAppWelcomeMessage" class="text-white text-lg"></p><div><button id="backToMentorBtn" class="bg-gray-600 hover:bg-gray-700 text-white rounded-lg px-4 py-2 border border-gray-400/50 transition-all mr-2" hidden>è¿”å›å¾Œå°</button><button id="taskAppLogoutBtn" class="bg-red-600/50 hover:bg-red-600/80 text-white rounded-lg px-4 py-2 border border-red-400/50 transition-all">ç™»å‡º</button></div></div><div class="text-center mb-8"><h1 class="text-4xl md:text-5xl font-bold text-white mb-2">ğŸ¢ BNIé›²è²´åˆ†æœƒ</h1><h2 class="text-2xl md:text-3xl font-semibold text-blue-200 mb-4">æ–°æ‰‹æ‘ä»»å‹™ç³»çµ±</h2></div><div class="bg-white/10 backdrop-blur-lg rounded-2xl p-6 mb-8 border border-white/20"><div class="flex flex-col md:flex-row items-center justify-between mb-6"><h2 id="progressTitle" class="text-xl md:text-2xl font-semibold text-white mb-4 md:mb-0">ç¸½é«”é€²åº¦</h2><div id="saveStatus" class="text-sm text-blue-200 h-4 flex items-center"></div><div class="flex items-center space-x-6"><div class="text-center"><div class="text-2xl md:text-3xl font-bold text-white" id="completedTasksTotal">0</div><div class="text-sm text-blue-200">å·²å®Œæˆ</div></div><div class="relative w-16 h-16 md:w-20 md:h-20"><svg class="progress-ring w-full h-full" viewBox="0 0 120 120"><circle class="progress-ring-circle stroke-white/20" stroke-width="8" fill="transparent" r="52" cx="60" cy="60"/><circle class="progress-ring-circle stroke-green-400" stroke-width="8" fill="transparent" r="52" cx="60" cy="60" stroke-dasharray="326.73" stroke-dashoffset="326.73" id="progressCircle"/></svg><div class="absolute inset-0 flex items-center justify-center"><span class="text-white font-bold text-sm" id="progressPercent">0%</span></div></div></div></div><div class="grid grid-cols-2 md:grid-cols-4 gap-4"><div class="bg-green-500/20 rounded-lg p-3 text-center"><div class="text-xl font-bold text-green-300" id="completedTasks">0</div><div class="text-green-200 text-sm">å·²å®Œæˆ</div></div><div class="bg-yellow-500/20 rounded-lg p-3 text-center"><div class="text-xl font-bold text-yellow-300" id="inProgressTasks">0</div><div class="text-yellow-200 text-sm">é€²è¡Œä¸­</div></div><div class="bg-blue-500/20 rounded-lg p-3 text-center"><div class="text-xl font-bold text-blue-300" id="notStartedTasks">0</div><div class="text-blue-200 text-sm">æœªé–‹å§‹</div></div><div class="bg-purple-500/20 rounded-lg p-3 text-center"><div class="text-xl font-bold text-purple-300" id="totalTasks">0</div><div class="text-purple-200 text-sm">å¿…ä¿®é—œå¡</div></div></div></div><div class="mb-8"><h3 class="text-lg font-semibold text-white mb-4">ä»»å‹™åˆ†é¡</h3><div class="flex flex-wrap gap-2" id="categoryFilters"><button class="category-filter active bg-white/10 backdrop-blur-lg px-4 py-2 rounded-full text-white text-sm font-medium border border-white/20" data-category="all">å…¨éƒ¨</button></div></div><div class="flex flex-col md:flex-row gap-4 mb-8"><div class="flex-grow"><input type="text" id="searchInput" placeholder="ğŸ” æœå°‹ä»»å‹™åç¨±æˆ–æè¿°..." class="w-full bg-white/10 text-white placeholder-blue-300 rounded-lg px-4 py-2 border border-white/20 focus:outline-none focus:ring-2 focus:ring-blue-400 transition-all"></div><div class="flex-shrink-0"><select id="sortSelect" class="w-full md:w-auto bg-white/10 text-white rounded-lg px-4 py-2 border border-white/20 focus:outline-none focus:ring-2 focus:ring-blue-400 transition-all"><option value="default" class="bg-indigo-800">é è¨­æ’åº</option><option value="status" class="bg-indigo-800">ä¾ç‹€æ…‹ (æœªé–‹å§‹å„ªå…ˆ)</option><option value="difficulty" class="bg-indigo-800">ä¾é›£åº¦ (åŸºç¤å„ªå…ˆ)</option></select></div><div class="flex-shrink-0"><button id="resetAllBtn" class="w-full md:w-auto bg-red-600/50 hover:bg-red-600/80 text-white rounded-lg px-4 py-2 border border-red-400/50 transition-all">ğŸ—‘ï¸ å…¨éƒ¨é‡ç½®</button></div></div><div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4" id="taskContainer"></div>
    
    <div id="modal" class="fixed inset-0 bg-black/50 backdrop-blur-sm hidden items-center justify-center z-50">
        <div class="bg-white rounded-2xl p-8 max-w-md w-11/12 text-center transform scale-95 transition-transform">
            <div id="modal-icon" class="text-6xl mb-4">ğŸ‰</div>
            <h3 id="modal-title" class="text-2xl font-bold text-gray-800 mb-2">æ­å–œå®Œæˆä»»å‹™ï¼</h3>
            <div id="modal-content" class="text-gray-600 mb-6"></div>
            <button id="modal-close-btn" class="bg-gradient-to-r from-blue-600 to-purple-600 text-white px-6 py-3 rounded-lg font-semibold hover:from-blue-700 hover:to-purple-700 transition-all">ç¹¼çºŒåŠ æ²¹ï¼</button>
        </div>
    </div>


    <script>
        (function() {
            const API_URL = 'https://script.google.com/macros/s/AKfycbyfCTkub5yQPonaEILuthwg_C_U37Rc3FDoANwwY9p__GDKrxTAS4VXNL6iD-q_MiwU_g/exec';
            const tasksTemplate = [
                {id:1,title:"æ–°æ‰‹åŒ…",description:"æ”¶åˆ°å€åŸŸå¯„é€çš„æœƒå“¡æ–°æ‰‹åŒ…",icon:"ğŸ“¦",difficulty:"åŸºç¤",reward:"æ–°æ‰‹è³‡æ–™åŒ…",category:"å…¥é–€æº–å‚™",isRequired:!0},{id:2,title:"åç‰Œ",description:"è£½ä½œå€‹äººå°ˆå±¬çš„BNIåç‰Œ",icon:"ğŸ·ï¸",difficulty:"åŸºç¤",reward:"å€‹äººåç‰Œ",category:"å…¥é–€æº–å‚™",isRequired:!0},{id:3,title:"åƒåŠ 25så°ˆæ¥­ç°¡å ±åŸ¹è¨“",description:"è§€çœ‹25ç§’å°ˆæ¥­ç°¡å ±æ•™å­¸å½±ç‰‡",icon:"ğŸ¤",difficulty:"åŸºç¤",reward:"ç°¡å ±æŠ€èƒ½",category:"å½±ç‰‡åŸ¹è¨“",videoUrl:"https://www.youtube.com/playlist?list=PLTMduYKemBTo1Vcmefgg7QhBL8oT4Ypkf",isRequired:!0},{id:4,title:"ã€å°å¸«è€ƒæ ¸ã€‘æ¯å‘¨25så°ˆæ¥­ç°¡å ±",description:"é€šéå°å¸«è€ƒæ ¸ï¼Œå±•ç¤º25ç§’å°ˆæ¥­ç°¡å ±èƒ½åŠ›",icon:"âœ…",difficulty:"è€ƒæ ¸",reward:"ç°¡å ±èªè­‰",category:"å°å¸«è€ƒæ ¸",isRequired:!0},{id:5,title:"ã€å°å¸«è€ƒæ ¸ã€‘25ç§’è‡ªæˆ‘ä»‹ç´¹åŠSlogan",description:"å®Œæˆ25ç§’è‡ªæˆ‘ä»‹ç´¹å’Œå€‹äººSloganå±•ç¤º",icon:"ğŸ—£ï¸",difficulty:"è€ƒæ ¸",reward:"è‡ªæˆ‘ä»‹ç´¹èªè­‰",category:"å°å¸«è€ƒæ ¸",isRequired:!0},{id:6,title:"åƒåŠ Connectç³»çµ±é–‹é€š&æ“ä½œåŸ¹è¨“",description:"è§€çœ‹Connectç³»çµ±æ•™å­¸å½±ç‰‡(å…±2éƒ¨)",icon:"ğŸ’»",difficulty:"åŸºç¤",reward:"ç³»çµ±æ“ä½œæŠ€èƒ½",category:"å½±ç‰‡åŸ¹è¨“",videoUrl:"https://www.youtube.com/playlist?list=PLTMduYKemBTo1Vcmefgg7QhBL8oT4Ypkf",isRequired:!0},{id:7,title:"ã€å°å¸«è€ƒæ ¸ã€‘Connectç³»çµ±é–‹é€š&æ“ä½œ",description:"é€šéConnectç³»çµ±é–‹é€š&æ“ä½œè€ƒæ ¸",icon:"ğŸ”—",difficulty:"è€ƒæ ¸",reward:"ç³»çµ±æ“ä½œèªè­‰",category:"å°å¸«è€ƒæ ¸",isRequired:!0},{id:8,title:"åƒåŠ ç›®æ¨™è¨­å®šåŸ¹è¨“",description:"è§€çœ‹ç›®æ¨™è¨­å®šæ•™å­¸å½±ç‰‡",icon:"ğŸ¯",difficulty:"åŸºç¤",reward:"ç›®æ¨™è¦åŠƒæŠ€èƒ½",category:"å½±ç‰‡åŸ¹è¨“",videoUrl:"https://www.youtube.com/playlist?list=PLTMduYKemBTo1Vcmefgg7QhBL8oT4Ypkf",isRequired:!0},{id:9,title:"ã€å°å¸«è€ƒæ ¸ã€‘ç›®æ¨™è¨­å®š",description:"å®Œæˆå€‹äººç›®æ¨™è¨­å®šä¸¦é€šéå°å¸«è€ƒæ ¸",icon:"ğŸ“Š",difficulty:"è€ƒæ ¸",reward:"ç›®æ¨™è¨­å®šèªè­‰",category:"å°å¸«è€ƒæ ¸",isRequired:!0},{id:10,title:"åƒåŠ äººè„ˆåˆä½œè®Šç¾è¡¨åŸ¹è¨“",description:"è§€çœ‹äººè„ˆåˆä½œè®Šç¾è¡¨æ•™å­¸å½±ç‰‡",icon:"ğŸ’°",difficulty:"é€²éš",reward:"è®Šç¾æŠ€èƒ½",category:"å½±ç‰‡åŸ¹è¨“",videoUrl:"https://www.youtube.com/playlist?list=PLTMduYKemBTo1Vcmefgg7QhBL8oT4Ypkf",isRequired:!0},{id:11,title:"ã€å°å¸«è€ƒæ ¸ã€‘äººè„ˆåˆä½œè®Šç¾è¡¨",description:"å®Œæˆäººè„ˆåˆä½œè®Šç¾è¡¨ä¸¦é€šéè€ƒæ ¸",icon:"ğŸ’",difficulty:"è€ƒæ ¸",reward:"è®Šç¾è¡¨èªè­‰",category:"å°å¸«è€ƒæ ¸",isRequired:!0},{id:12,title:"æ–°æœƒå“¡è¦‹é¢æœƒ",description:"åƒèˆ‡æ¯æœˆä¸€æ¬¡ç”±å€åŸŸæ’å®šæ™‚é–“çš„æ–°äººè¦‹é¢æœƒ",icon:"ğŸ¤",difficulty:"åŸºç¤",reward:"äººè„ˆå»ºç«‹",category:"å¯¦é«”æ´»å‹•",completionCondition:"åƒèˆ‡æ¯æœˆä¸€æ¬¡ç”±å€åŸŸæ’å®šæ™‚é–“çš„æ–°äººè¦‹é¢æœƒ(ä¸€å€‹æœˆåªæœ‰ä¸€æ¬¡å¾ˆé‡è¦)",isRequired:!0},{id:13,title:"FBå€åŸŸç²‰å°ˆæŒ‰è®š",description:"é›²è²´åˆ†æœƒFBé»è®š",icon:"ğŸ‘",difficulty:"åŸºç¤",reward:"ç¤¾ç¾¤é€£çµ",category:"ç¤¾äº¤æ´»å‹•",fbUrl:"https://www.facebook.com/bni.yungui",isRequired:!0},{id:14,title:"åˆéšMSP",description:"å ±åå€åŸŸåŸ¹è¨“èª²ç¨‹(èˆ‡é€²éšMSPæ“‡ä¸€å³å¯)",icon:"ğŸ“ˆ",difficulty:"é€²éš",reward:"åˆéšMSPè­‰æ›¸",category:"ç·šä¸Šèª²ç¨‹",courseUrl:"https://ally.nime.com.tw/html/memberLogin",isRequired:!0},{id:15,title:"é€²éšMSP",description:"å ±åå€åŸŸåŸ¹è¨“èª²ç¨‹(èˆ‡åˆéšMSPæ“‡ä¸€å³å¯)",icon:"ğŸš€",difficulty:"é€²éš",reward:"é€²éšMSPè­‰æ›¸",category:"ç·šä¸Šèª²ç¨‹",courseUrl:"https://ally.nime.com.tw/html/memberLogin",isRequired:!0},{id:16,title:"æœƒå“¡æˆåŠŸè—åœ–",description:"åƒèˆ‡å°å¸«å…«å‘¨ç‰¹å®šä¸»é¡Œ",icon:"ğŸ—ºï¸",difficulty:"é€²éš",reward:"æˆåŠŸè—åœ–",category:"å°å¸«å…«å‘¨",isRequired:!0},{id:17,title:"æ–°æœƒå“¡è­·ç…§",description:"åƒèˆ‡å°å¸«å…«å‘¨ç‰¹å®šä¸»é¡Œ",icon:"ğŸ“˜",difficulty:"é€²éš",reward:"æœƒå“¡è­·ç…§",category:"å°å¸«å…«å‘¨",isRequired:!0},{id:18,title:"å°å¸«å…«å‘¨",description:"åƒèˆ‡4æ¬¡æ¯å‘¨å››å°å¸«å…«å‘¨",icon:"ğŸ§™â€â™‚ï¸",difficulty:"é€²éš",reward:"å°å¸«æŒ‡å°å®Œæˆè­‰æ›¸",category:"å°å¸«å…«å‘¨",weeklyTopics:["W1: æœƒå“¡æˆåŠŸè—åœ–/å‡ºå¸­çš„é‡è¦æ€§","W2: è¡Œæ”¿å°çµ„é‹ä½œ/æ˜ç¢ºç›®æ¨™","W3: æ–°æœƒå“¡è­·ç…§/å‘Šè¨´æˆ‘å€‘æ€éº¼èªª","W4: é‚€ç´„ä¾†è³“å¿ƒæ³•èˆ‡æŠ€å·§/å¸¶ä¾†å°é“å…·","W5: æœƒå“¡æˆåŠŸè—åœ–/éåŒå‡¡éŸ¿çš„è¦‹è­‰","W6: è¡Œæ”¿å°çµ„é‹ä½œ/ä¸€å°ä¸€æœƒé¢","W7: æ–°æœƒå“¡è­·ç…§/ç‚ºä»€éº¼è¦å¸¶ä¾†è³“","W8: é‚€ç´„ä¾†è³“å¿ƒæ³•èˆ‡æŠ€å·§/æˆ‘å€‘æ‡‰è©²æ€éº¼åš"],isRequired:!0,isCountable:!0,targetCount:4},{id:19,title:"å…¨åœ‹åˆ†äº«æœƒ",description:"åƒèˆ‡æ¯å‘¨ä¸€å…¨åœ‹åˆ†äº«æœƒ1æ¬¡",icon:"ğŸŒŸ",difficulty:"é€²éš",reward:"å…¨åœ‹è¦–é‡",category:"å¤§å‹æ´»å‹•",isRequired:!0},{id:20,title:"åƒåŠ ç´…ç¶ ç‡ˆè¨ˆç®—åŸ¹è¨“",description:"è§€çœ‹ç´…ç¶ ç‡ˆè¨ˆç®—æ•™å­¸å½±ç‰‡",icon:"ğŸš¦",difficulty:"é€²éš",reward:"åˆ†ææŠ€èƒ½",category:"å½±ç‰‡åŸ¹è¨“",videoUrl:"https://www.youtube.com/playlist?list=PLTMduYKemBTo1Vcmefgg7QhBL8oT4Ypkf",isRequired:!0},{id:21,title:"ã€å°å¸«è€ƒæ ¸ã€‘ç´…ç¶ ç‡ˆè¨ˆç®—",description:"é€šéç´…ç¶ ç‡ˆè¨ˆç®—æ–¹æ³•è€ƒæ ¸",icon:"ğŸ“Š",difficulty:"è€ƒæ ¸",reward:"åˆ†æèªè­‰",category:"å°å¸«è€ƒæ ¸",isRequired:!0},{id:22,title:"å°å¸«ç¤ºç¯„ä¸€å°ä¸€",description:"é‚€ç´„å°å¸«ç”±å°å¸«ç¤ºç¯„ä¸€å°ä¸€",icon:"ğŸ‘ï¸",difficulty:"é€²éš",reward:"å¯¦æˆ°ç¶“é©—",category:"å¯¦æˆ°å­¸ç¿’",isRequired:!0},{id:23,title:"å‚åŠ 1-1è¡¨æ ¼ 1ã€2è¡¨åŸ¹è¨“",description:"è§€çœ‹1-1è¡¨æ ¼æ•™å­¸å½±ç‰‡",icon:"ğŸ“‹",difficulty:"é€²éš",reward:"è¡¨æ ¼æŠ€èƒ½",category:"å½±ç‰‡åŸ¹è¨“",videoUrl:"https://www.youtube.com/playlist?list=PLTMduYKemBTo1Vcmefgg7QhBL8oT4Ypkf",isRequired:!0},{id:24,title:"ã€å°å¸«è€ƒæ ¸ã€‘å®Œæˆ1-1è¡¨æ ¼ 1ã€2è¡¨",description:"å®Œæˆ1-1è¡¨æ ¼1ã€2è¡¨ä¸¦é€šéè€ƒæ ¸",icon:"âœï¸",difficulty:"è€ƒæ ¸",reward:"è¡¨æ ¼èªè­‰",category:"å°å¸«è€ƒæ ¸",isRequired:!0},{id:25,title:"å‚åŠ 1-1è¡¨æ ¼ 3ã€4è¡¨åŸ¹è¨“",description:"è§€çœ‹1-1è¡¨æ ¼æ•™å­¸å½±ç‰‡",icon:"ğŸ“„",difficulty:"é€²éš",reward:"é€²éšè¡¨æ ¼æŠ€èƒ½",category:"å½±ç‰‡åŸ¹è¨“",videoUrl:"https://www.youtube.com/playlist?list=PLTMduYKemBTo1Vcmefgg7QhBL8oT4Ypkf",isRequired:!0},{id:26,title:"ã€å°å¸«è€ƒæ ¸ã€‘å®Œæˆ1-1è¡¨æ ¼ 3ã€4è¡¨",description:"å®Œæˆ1-1è¡¨æ ¼3ã€4è¡¨ä¸¦é€šéè€ƒæ ¸",icon:"ğŸ“",difficulty:"è€ƒæ ¸",reward:"é€²éšè¡¨æ ¼èªè­‰",category:"å°å¸«è€ƒæ ¸",isRequired:!0},{id:27,title:"ç°¡å ±å·¥ä½œåŠ(é¸ä¿®)",description:"å ±åå€åŸŸåŸ¹è¨“èª²ç¨‹",icon:"ğŸª",difficulty:"é¸ä¿®",reward:"ç°¡å ±å°ˆç²¾æŠ€èƒ½",category:"é¸ä¿®èª²ç¨‹",courseUrl:"https://ally.nime.com.tw/html/memberLogin",isRequired:!1},{id:28,title:"ä¸€å°ä¸€å·¥ä½œåŠ(é¸ä¿®)",description:"å ±åå€åŸŸåŸ¹è¨“èª²ç¨‹",icon:"ğŸ‘¥",difficulty:"é¸ä¿®",reward:"é¢è«‡æŠ€èƒ½",category:"é¸ä¿®èª²ç¨‹",courseUrl:"https://ally.nime.com.tw/html/memberLogin",isRequired:!1},{id:29,title:"èˆ‡å°å¸«ä¸€å°ä¸€(é¸ä¿®)",description:"é‚€ç´„å°å¸«é€²è¡Œä¸€å°ä¸€é¢è«‡",icon:"ğŸ¯",difficulty:"é¸ä¿®",reward:"å°å¸«æŒ‡å°",category:"é¸ä¿®èª²ç¨‹",isRequired:!1},{id:30,title:"èˆ‡è‘£é¡§å¤§ä½¿ä¸€å°ä¸€(é¸ä¿®)",description:"é‚€ç´„è‘£äº‹é¡§å•å¤§ä½¿é€²è¡Œä¸€å°ä¸€é¢è«‡",icon:"ğŸ‘”",difficulty:"é¸ä¿®",reward:"é«˜éšæŒ‡å°",category:"é¸ä¿®èª²ç¨‹",isRequired:!1},{id:31,title:"èˆ‡ä¹é•·ä¸€å°ä¸€(é¸ä¿®)",description:"é‚€ç´„ä¹é•·é€²è¡Œä¸€å°ä¸€é¢è«‡äº¤æµ",icon:"ğŸ†",difficulty:"é¸ä¿®",reward:"é ˜å°æŒ‡å°",category:"é¸ä¿®èª²ç¨‹",isRequired:!1}
            ];
            
            let currentUser = null, currentlyViewingName = '', tasks = [], currentFilter = 'all', currentSort = 'default', currentSearch = '', saveTimeout;
            
            // --- åµéŒ¯ç‰ˆ Modal å‡½å¼ ---
            function showModal({icon, title, content, buttonText}) {
                const modal = document.getElementById('modal');
                document.getElementById('modal-icon').textContent = icon;
                document.getElementById('modal-title').textContent = title;
                document.getElementById('modal-content').innerHTML = ''; // æ¸…ç©ºèˆŠå…§å®¹
                
                // å¦‚æœ content æ˜¯å­—ä¸²ï¼Œå°±ç›´æ¥é¡¯ç¤º
                if (typeof content === 'string') {
                    const p = document.createElement('p');
                    p.textContent = content;
                    document.getElementById('modal-content').appendChild(p);
                } else { // å¦å‰‡å‡å®šæ˜¯ HTML å…ƒç´ 
                    document.getElementById('modal-content').appendChild(content);
                }

                document.getElementById('modal-close-btn').textContent = buttonText;
                modal.classList.remove('hidden');
                modal.classList.add('flex');
            }

            function closeModel() {
                document.getElementById('modal').classList.add('hidden');
                document.getElementById('modal').classList.remove('flex');
            }

            function showCelebration(taskTitle, customMessage = null) {
                const message = customMessage || `å·²å®Œæˆä»»å‹™ï¼š${taskTitle}ã€‚ç¹¼çºŒä¿æŒï¼`;
                const title = customMessage ? 'ğŸ‰ æ­å–œï¼ ğŸ‰' : 'æ­å–œå®Œæˆä»»å‹™ï¼';
                showModal({ icon: 'ğŸ‰', title: title, content: message, buttonText: 'ç¹¼çºŒåŠ æ²¹ï¼' });
            }
            
            // *** åµéŒ¯æ ¸å¿ƒï¼šæ–°çš„ apiCall å‡½å¼ ***
            async function apiCall(action, payload) {
                const messageEl = (action === 'login' || action === 'getLeaderboardData') ? document.getElementById('loginMessage') : document.getElementById('mentorActionMessage');
                if (messageEl) messageEl.textContent = 'è™•ç†ä¸­...';
                
                try {
                    const response = await fetch(API_URL, {
                        method: 'POST', redirect: 'follow', headers: { 'Content-Type': 'text/plain;charset=utf-8' },
                        body: JSON.stringify({ action, payload })
                    });
                    
                    if (!response.ok) {
                        throw new Error(`ç¶²è·¯éŒ¯èª¤ï¼Œç‹€æ…‹ç¢¼: ${response.status}`);
                    }

                    const result = await response.json();

                    if (result.status === 'success') {
                        if (messageEl) messageEl.textContent = '';
                        return result.data;
                    }
                    // å¦‚æœå¾Œç«¯å›å ±éŒ¯èª¤ï¼Œä¹ŸæŠŠå®ƒä¸Ÿå‡ºä¾†
                    throw new Error(result.message || 'å¾Œç«¯å›å ±æœªçŸ¥éŒ¯èª¤');
                } catch (error) {
                    const errorMsgForUser = `æ“ä½œå¤±æ•—ï¼Œè«‹å°‡ä»¥ä¸‹æ‰€æœ‰åµéŒ¯æ–‡å­—å®Œæ•´è¤‡è£½å›å ±`;
                    if (messageEl) messageEl.textContent = 'æ“ä½œå¤±æ•—ï¼Œè«‹æŸ¥çœ‹å½ˆå‡ºè¦–çª—';

                    const debugContent = document.createElement('textarea');
                    debugContent.id = 'debug-textarea';
                    debugContent.rows = 8;
                    debugContent.className = 'w-full p-2 text-xs rounded-md';
                    debugContent.value = `[éŒ¯èª¤æ‘˜è¦]\n${error.message}\n\n[åµéŒ¯è³‡è¨Š]\nAction: ${action}\nPayload: ${JSON.stringify(payload, null, 2)}\nError Name: ${error.name}\nError Stack: ${error.stack || 'N/A'}`;
                    debugContent.readOnly = true;

                    // ä½¿ç”¨æ–°çš„ Modal é¡¯ç¤ºè©³ç´°éŒ¯èª¤
                    showModal({
                        icon: 'âš ï¸',
                        title: 'ç™¼ç”ŸéŒ¯èª¤',
                        content: debugContent,
                        buttonText: 'é—œé–‰'
                    });

                    // å‘ä¸Šæ‹‹å‡ºéŒ¯èª¤ï¼Œè®“å‘¼å«å®ƒçš„å‡½å¼çŸ¥é“å·²ç¶“å‡ºéŒ¯
                    throw error;
                }
            }

            // --- ä»¥ä¸‹ç‚ºæ—¢æœ‰å‡½å¼ï¼Œé‚è¼¯ç„¡è®Šå‹• ---
            async function loadLeaderboard() { try { const leaderboardData = await apiCall('getLeaderboardData', {}); renderLeaderboard(leaderboardData); } catch (e) { console.error("Failed to load leaderboard:", e); } }
            function renderLeaderboard(data) { const container = document.getElementById('leaderboardContainer'); const loadingEl = document.getElementById('leaderboardLoading'); loadingEl.hidden = true; container.innerHTML = ''; if (!data || data.length === 0) { container.innerHTML = `<p class="text-blue-200 text-center">ç›®å‰æ²’æœ‰å°ç”Ÿè³‡æ–™</p>`; return; } data.forEach((mentee, index) => { const rankColor = index === 0 ? 'text-yellow-300' : index === 1 ? 'text-gray-300' : index === 2 ? 'text-yellow-600' : 'text-blue-300'; const progress = Math.round(mentee.progress); const div = document.createElement('div'); div.className = 'flex items-center gap-4 text-white'; div.innerHTML = `<span class="w-8 text-lg font-bold ${rankColor}">#${index + 1}</span><div class="flex-grow"><p class="font-semibold">${mentee.name}</p><div class="w-full bg-black/20 rounded-full h-2.5"><div class="bg-green-500 h-2.5 rounded-full" style="width: ${progress}%"></div></div></div><span class="w-12 text-right font-semibold">${progress}%</span>`; container.appendChild(div); }); }
            async function handleLogin() { const name = document.getElementById('nameInput').value.trim(); const password = document.getElementById('passwordInput').value; if (!name) return; try { currentUser = await apiCall('login', { name, password }); sessionStorage.setItem('bniUser', JSON.stringify(currentUser)); switchView(); } catch (e) { /* error is now handled by the modal */ } }
            function handleLogout() { currentUser = null; currentlyViewingName = ''; sessionStorage.removeItem('bniUser'); switchView(); }
            function switchView() { document.getElementById('loginContainer').hidden = true; document.getElementById('mentorContainer').hidden = true; document.getElementById('taskAppContainer').hidden = true; if (!currentUser) { document.getElementById('loginContainer').hidden = false; document.getElementById('nameInput').value = ''; document.getElementById('passwordInput').value = ''; loadLeaderboard(); } else if (currentUser.role === 'mentor' && !currentlyViewingName) { document.getElementById('mentorContainer').hidden = false; loadMentorDashboard(); } else { document.getElementById('taskAppContainer').hidden = false; loadTaskApp(); } }
            async function loadMentorDashboard() { document.getElementById('mentorWelcomeMessage').textContent = `æ­¡è¿, å°å¸« ${currentUser.name}`; try { const mentees = await apiCall('getMenteesList', { mentorName: currentUser.name }); renderMenteeList(mentees); } catch (e) {} }
            function renderMenteeList(mentees) { const container = document.getElementById('menteeListContainer'); container.innerHTML = mentees.length === 0 ? `<p class="text-blue-300">ç›®å‰æ²’æœ‰å°ç”Ÿ</p>` : ''; mentees.forEach(name => { const div = document.createElement('div'); div.className = 'bg-white/5 rounded-lg p-3 flex justify-between items-center'; div.innerHTML = `<span class="text-white font-semibold cursor-pointer hover:text-blue-300">${name}</span><button data-name="${name}" class="delete-mentee-btn bg-red-800 hover:bg-red-700 text-white rounded px-3 py-1 text-xs">åˆªé™¤</button>`; div.querySelector('span').addEventListener('click', () => viewMenteeTasks(name)); container.appendChild(div); }); }
            async function handleAddMentee() { const input = document.getElementById('newMenteeNameInput'); const menteeName = input.value.trim(); if (!menteeName) return; const msgEl = document.getElementById('mentorActionMessage'); try { await apiCall('addNewMentee', { menteeName, mentorName: currentUser.name }); msgEl.className = 'text-green-300 mt-2 h-4'; msgEl.textContent = `æˆåŠŸæ–°å¢å°ç”Ÿ ${menteeName}`; input.value = ''; loadMentorDashboard(); } catch (e) { msgEl.className = 'text-red-400 mt-2 h-4'; } }
            async function handleDeleteMentee(e) { if (!e.target.classList.contains('delete-mentee-btn')) return; const menteeName = e.target.dataset.name; if (confirm(`æ‚¨ç¢ºå®šè¦åˆªé™¤å°ç”Ÿ "${menteeName}" çš„æ‰€æœ‰è³‡æ–™å—ï¼Ÿæ­¤æ“ä½œç„¡æ³•å¾©åŸï¼`)) { const msgEl = document.getElementById('mentorActionMessage'); try { await apiCall('deleteMentee', { menteeName, mentorName: currentUser.name }); msgEl.className = 'text-green-300 mt-2 h-4'; msgEl.textContent = `æˆåŠŸåˆªé™¤å°ç”Ÿ ${menteeName}`; loadMentorDashboard(); } catch (e) { msgEl.className = 'text-red-400 mt-2 h-4'; } } }
            function viewMenteeTasks(name) { currentlyViewingName = name; switchView(); }
            function backToMentorDashboard() { currentlyViewingName = ''; switchView(); }
            async function loadTaskApp() { const nameToLoad = currentlyViewingName || currentUser.name; document.getElementById('backToMentorBtn').hidden = !(currentUser.role === 'mentor'); document.getElementById('taskAppWelcomeMessage').textContent = `æ­¡è¿, ${currentUser.name}`; document.getElementById('progressTitle').textContent = `${nameToLoad} çš„ä»»å‹™é€²åº¦`; try { const savedTasks = await apiCall('getTasks', { name: nameToLoad }); initializeUserData(savedTasks); runTaskAppDisplay(); } catch(e) {} }
            function runTaskAppDisplay() { generateCategoryFilters(); filterTasks('all'); updateProgress(); }
            function initializeUserData(savedTasks) { tasks = tasksTemplate.map(template => ({...template, status: 'not-started', currentCount: 0 })); tasks.forEach(task => { const saved = savedTasks.find(s => s.id == task.id); if (saved) { task.status = saved.status; task.currentCount = saved.currentCount || 0; } }); }
            function saveTasks() { const nameToSave = currentlyViewingName || currentUser.name; const saveStatus = document.getElementById('saveStatus'); saveStatus.innerHTML = `<div class="spinner w-4 h-4 rounded-full animate-spin border-2 border-solid mr-2"></div> å„²å­˜ä¸­...`; clearTimeout(saveTimeout); saveTimeout = setTimeout(async () => { const dataToSave = tasks.map(t => ({ id: t.id, status: t.status, currentCount: t.currentCount || 0 })); try { await apiCall('saveTasks', { name: nameToSave, tasks: dataToSave, requesterName: currentUser.name, requesterRole: currentUser.role }); saveStatus.textContent = `âœ… é€²åº¦å·²åŒæ­¥è‡³é›²ç«¯`; } catch (e) { saveStatus.textContent = `âŒ å„²å­˜å¤±æ•—`; } }, 1500); }
            function updateTaskStatus(taskId, newStatus) { const task = tasks.find(t => t.id == taskId); if (task) { const oldStatus = task.status; task.status = newStatus; if (tasksTemplate.find(t=>t.id==taskId)?.isCountable && newStatus === 'not-started') task.currentCount = 0; if (oldStatus !== 'completed' && newStatus === 'completed') showCelebration(tasksTemplate.find(t=>t.id==taskId)?.title); renderTasks(); updateProgress(); saveTasks(); } }
            function incrementCount(taskId) { const task = tasks.find(t => t.id == taskId); const taskTemplate = tasksTemplate.find(t => t.id == taskId); if (task && taskTemplate?.isCountable && task.currentCount < taskTemplate.targetCount) { task.currentCount++; task.status = task.currentCount === taskTemplate.targetCount ? 'completed' : 'in-progress'; if (task.status === 'completed') showCelebration(taskTemplate.title); renderTasks(); updateProgress(); saveTasks(); } }
            function decrementCount(taskId) { const task = tasks.find(t => t.id == taskId); if (task && tasksTemplate.find(t=>t.id==taskId)?.isCountable && task.currentCount > 0) { task.currentCount--; task.status = task.currentCount === 0 ? 'not-started' : 'in-progress'; renderTasks(); updateProgress(); saveTasks(); } }
            function resetAllTasks() { if (confirm(`æ‚¨ç¢ºå®šè¦é‡ç½® ${currentlyViewingName || currentUser.name} çš„æ‰€æœ‰ä»»å‹™é€²åº¦å—ï¼Ÿ`)) { initializeUserData([]); renderTasks(); updateProgress(); saveTasks(); alert('æ‰€æœ‰ä»»å‹™é€²åº¦å·²é‡ç½®ï¼'); } }
            function generateCategoryFilters() { const c = document.getElementById('categoryFilters'); if (c.children.length > 1) return; const a=[...new Set(tasksTemplate.map(t=>t.category))], b=c.querySelector('[data-category="all"]'), d=tasksTemplate.filter(t=>t.isRequired).length, e=tasksTemplate.filter(t=>!t.isRequired).length; b.textContent=`å…¨éƒ¨ (${d}å¿…ä¿®+${e}é¸ä¿®)`; a.forEach(f=>{const g=tasksTemplate.filter(t=>t.category===f).length,h=document.createElement('button'); h.className='category-filter bg-white/10 backdrop-blur-lg px-4 py-2 rounded-full text-white text-sm font-medium border border-white/20'; h.setAttribute('data-category',f); h.textContent=`${f} (${g})`; c.appendChild(h)}); c.querySelectorAll('.category-filter').forEach(btn => btn.addEventListener('click', () => filterTasks(btn.dataset.category))) }
            function filterTasks(category) { currentFilter = category; document.querySelectorAll('.category-filter').forEach(btn => btn.classList.remove('active')); document.querySelector(`[data-category="${category}"]`).classList.add('active'); renderTasks(); }
            function renderTasks() { const container = document.getElementById('taskContainer'); container.innerHTML = ''; let processedTasks = [...tasks]; const taskTemplatesById = Object.fromEntries(tasksTemplate.map(t => [t.id, t])); processedTasks.forEach(task => task.category = taskTemplatesById[task.id]?.category); if (currentFilter !== 'all') { processedTasks = processedTasks.filter(task => task.category === currentFilter); } if (currentSearch) { const searchTerm = currentSearch.toLowerCase(); processedTasks = processedTasks.filter(task => taskTemplatesById[task.id]?.title.toLowerCase().includes(searchTerm) || taskTemplatesById[task.id]?.description.toLowerCase().includes(searchTerm)); } const difficultyOrder = { 'åŸºç¤': 1, 'é€²éš': 2, 'è€ƒæ ¸': 3, 'é¸ä¿®': 4 }; const statusOrder = { 'not-started': 1, 'in-progress': 2, 'completed': 3 }; processedTasks.sort((a, b) => { const diffA = difficultyOrder[taskTemplatesById[a.id]?.difficulty] || 99; const diffB = difficultyOrder[taskTemplatesById[b.id]?.difficulty] || 99; if (currentSort === 'status') { return statusOrder[a.status] - statusOrder[b.status] || a.id - b.id; } if (currentSort === 'difficulty') { return diffA - diffB || a.id - b.id; } return a.id - b.id; }); processedTasks.forEach(task => { const taskTemplate = taskTemplatesById[task.id] || {}; const isAssessment = taskTemplate.difficulty === 'è€ƒæ ¸'; const menteeCannotOperate = currentUser.role === 'mentee' && !currentlyViewingName; const disabledState = isAssessment && menteeCannotOperate; const disabledTitle = 'æ­¤é …ç›®éœ€ç”±å°å¸«æ“ä½œ'; const statusClass = task.status; const statusText = task.status === 'completed' ? 'å·²å®Œæˆ' : task.status === 'in-progress' ? 'é€²è¡Œä¸­' : 'æœªé–‹å§‹'; const statusIcon = task.status === 'completed' ? 'âœ…' : task.status === 'in-progress' ? 'â³' : 'â­•'; const difficultyColor = taskTemplate.difficulty === 'åŸºç¤' ? 'text-green-400' : taskTemplate.difficulty === 'é€²éš' ? 'text-yellow-400' : taskTemplate.difficulty === 'è€ƒæ ¸' ? 'text-red-400' : taskTemplate.difficulty === 'é¸ä¿®' ? 'text-purple-400' : 'text-orange-400'; const countDisplay = taskTemplate.isCountable ? `<div class="bg-blue-500/20 rounded-lg p-2 mb-3"><div class="flex items-center justify-between"><span class="text-sm text-blue-300">é€²åº¦</span><span class="text-base font-bold text-blue-200">${task.currentCount}/${taskTemplate.targetCount}</span></div><div class="w-full bg-white/10 rounded-full h-2 mt-1"><div class="bg-blue-400 h-2 rounded-full transition-all" style="width: ${taskTemplate.targetCount > 0 ? (task.currentCount / taskTemplate.targetCount) * 100 : 0}%"></div></div></div>` : ''; const startCompleteButton = task.status !== 'completed' ? `<button data-task-id="${task.id}" data-status="${task.status === 'not-started' ? 'in-progress' : 'completed'}" class="flex-1 py-2 px-3 rounded-lg font-medium text-base transition-all status-change-btn ${disabledState ? 'bg-gray-600 text-gray-400 cursor-not-allowed' : (task.status === 'not-started' ? 'bg-blue-600 hover:bg-blue-700 text-white' : 'bg-green-600 hover:bg-green-700 text-white')}" ${disabledState ? `disabled title="${disabledTitle}"` : ''}>${task.status === 'not-started' ? 'é–‹å§‹' : 'å®Œæˆ'}</button>` : ''; const resetButton = task.status !== 'not-started' ? `<button data-task-id="${task.id}" data-status="not-started" class="py-2 px-3 bg-gray-600 text-white rounded-lg font-medium text-base transition-all status-change-btn ${disabledState ? 'hover:bg-gray-600 text-gray-400 cursor-not-allowed' : 'hover:bg-gray-700'}" ${disabledState ? `disabled title="${disabledTitle}"` : ''}>é‡ç½®</button>` : ''; const counterButtons = taskTemplate.isCountable ? `${task.currentCount < taskTemplate.targetCount ? `<button data-task-id="${task.id}" class="flex-1 py-2 px-3 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium text-base transition-all increment-btn">+1 æ¬¡åƒèˆ‡</button>` : ''}${task.currentCount > 0 ? `<button data-task-id="${task.id}" class="py-2 px-3 bg-gray-600 hover:bg-gray-700 text-white rounded-lg font-medium text-base transition-all decrement-btn">-1</button>` : ''}` : `${startCompleteButton}${resetButton}`; const card = document.createElement('div'); card.className = `task-card bg-white/10 backdrop-blur-lg rounded-2xl p-5 border border-white/20 flex flex-col ${statusClass}`; card.innerHTML = `<div class="flex-grow"><div class="flex items-start justify-between mb-3"><div class="text-3xl">${taskTemplate.icon}</div><div class="flex items-center space-x-2"><span class="text-sm">${statusIcon}</span><span class="text-base">${statusText}</span></div></div><h3 class="text-lg font-semibold text-white mb-2 leading-tight">${taskTemplate.title}</h3><p class="text-blue-200 mb-3 text-sm leading-relaxed">${taskTemplate.description || ''}</p>${countDisplay}<div class="flex items-center justify-between mb-3"><span class="text-sm ${difficultyColor} font-medium px-2 py-1 bg-white/10 rounded">${taskTemplate.difficulty}</span><span class="text-sm text-purple-300">ğŸ ${taskTemplate.reward}</span></div><div class="text-sm text-blue-300 mb-3">${taskTemplate.category}</div><div class="bg-white/5 rounded-lg p-3 mb-3"><div class="text-base text-gray-300 mb-1">å®Œæˆæ¢ä»¶ï¼š</div><div class="text-base text-white">${taskTemplate.completionCondition || taskTemplate.description}</div>${taskTemplate.videoUrl ? `<div class="mt-2"><button class="inline-flex items-center text-base text-blue-300 hover:text-blue-200 transition-colors cursor-pointer external-link" data-url="${taskTemplate.videoUrl}">ğŸ“¹ è§€çœ‹æ•™å­¸å½±ç‰‡</button></div>` : ''}${taskTemplate.fbUrl ? `<div class="mt-2"><button class="inline-flex items-center text-base text-blue-300 hover:text-blue-200 transition-colors cursor-pointer external-link" data-url="${taskTemplate.fbUrl}">ğŸ‘ å‰å¾€FBç²‰å°ˆ</button></div>` : ''}${taskTemplate.courseUrl ? `<div class="mt-2"><button class="inline-flex items-center text-base text-blue-300 hover:text-blue-200 transition-colors cursor-pointer external-link" data-url="${taskTemplate.courseUrl}">ğŸ“š å‰å¾€èª²ç¨‹å ±å</button></div>` : ''}</div></div><div class="mt-auto flex space-x-2">${counterButtons}</div>`; container.appendChild(card); }); bindCardEventListeners(); }
            function updateProgress() { const requiredTasks = tasks.filter(t => tasksTemplate.find(tt => tt.id == t.id)?.isRequired); let completedCount = 0; const mspGroupCompleted = requiredTasks.some(t => (t.id == 14 || t.id == 15) && t.status === 'completed'); requiredTasks.forEach(task => { if (!(task.id == 14 || task.id == 15) && task.status === 'completed') { completedCount++; } }); if (mspGroupCompleted) completedCount++; const nonMspTasksCount = tasksTemplate.filter(t => t.isRequired && t.id != 14 && t.id != 15).length; const totalRequired = nonMspTasksCount + 1; const inProgressCount = tasks.filter(t => t.status === 'in-progress' && tasksTemplate.find(tt => tt.id == t.id)?.isRequired).length; const notStartedCount = tasks.filter(t => t.status === 'not-started' && tasksTemplate.find(tt => tt.id == t.id)?.isRequired).length; const allCompletedCount = tasks.filter(t => t.status === 'completed' && tasksTemplate.find(tt => tt.id == t.id)?.isRequired).length; document.getElementById('completedTasks').textContent = allCompletedCount; document.getElementById('completedTasksTotal').textContent = allCompletedCount; document.getElementById('inProgressTasks').textContent = inProgressCount; document.getElementById('notStartedTasks').textContent = notStartedCount; document.getElementById('totalTasks').textContent = totalRequired; const progressPercent = totalRequired > 0 ? (completedCount / totalRequired) * 100 : 0; document.getElementById('progressPercent').textContent = `${Math.round(progressPercent)}%`; const progressCircle = document.getElementById('progressCircle'); const circumference = 2 * Math.PI * progressCircle.r.baseVal.value; progressCircle.style.strokeDashoffset = circumference - (progressPercent / 100) * circumference; const celebrationKey = 'celebrated' + (currentlyViewingName || currentUser.name); if (progressPercent >= 100 && !sessionStorage.getItem(celebrationKey)) { showCelebration("æ‰€æœ‰å¿…ä¿®ä»»å‹™", `æ­å–œ ${currentlyViewingName || currentUser.name}ï¼å·²å®Œæˆæ‰€æœ‰å¿…ä¿®é—œå¡ï¼`); sessionStorage.setItem(celebrationKey, 'true'); } }
            function bindCardEventListeners() { document.querySelectorAll('.increment-btn, .decrement-btn, .status-change-btn, .external-link').forEach(button => { const clone = button.cloneNode(true); button.parentNode.replaceChild(clone, button); }); document.querySelectorAll('.increment-btn').forEach(b => b.addEventListener('click', (e) => { e.stopPropagation(); incrementCount(e.target.dataset.taskId); })); document.querySelectorAll('.decrement-btn').forEach(b => b.addEventListener('click', (e) => { e.stopPropagation(); decrementCount(e.target.dataset.taskId); })); document.querySelectorAll('.status-change-btn').forEach(b => b.addEventListener('click', (e) => { e.stopPropagation(); updateTaskStatus(e.target.dataset.taskId, e.target.dataset.status); })); document.querySelectorAll('.external-link').forEach(b => b.addEventListener('click', (e) => { e.stopPropagation(); window.open(e.target.dataset.url, '_blank'); })); }
            
            function init() {
                document.getElementById('loginBtn').addEventListener('click', handleLogin);
                document.getElementById('nameInput').addEventListener('keypress', (e) => { if (e.key === 'Enter') handleLogin(); });
                document.getElementById('passwordInput').addEventListener('keypress', (e) => { if (e.key === 'Enter') handleLogin(); });
                document.getElementById('mentorLogoutBtn').addEventListener('click', handleLogout);
                document.getElementById('addMenteeBtn').addEventListener('click', handleAddMentee);
                document.getElementById('menteeListContainer').addEventListener('click', handleDeleteMentee);
                document.getElementById('taskAppLogoutBtn').addEventListener('click', handleLogout);
                document.getElementById('backToMentorBtn').addEventListener('click', backToMentorDashboard);
                document.getElementById('modal-close-btn').addEventListener('click', closeModel);
                document.getElementById('sortSelect').addEventListener('change', (e) => { currentSort = e.target.value; renderTasks(); });
                document.getElementById('searchInput').addEventListener('input', (e) => { currentSearch = e.target.value; renderTasks(); });
                document.getElementById('resetAllBtn').addEventListener('click', resetAllTasks);
                const storedUser = sessionStorage.getItem('bniUser');
                if (storedUser) {
                    currentUser = JSON.parse(storedUser);
                }
                switchView();
            }

            window.addEventListener('load', init);
        })();
    </script>
</body>
</html>
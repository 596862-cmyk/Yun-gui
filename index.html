<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BNIé›²è²´åˆ†æœƒ - æ–°æ‰‹æ‘ä»»å‹™ç³»çµ±</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;600;700&display=swap');
        html { transition: font-size 0.2s ease-in-out; }
        body { font-family: 'Noto Sans TC', sans-serif; overflow-x: hidden; }
        .task-card { transition: all 0.3s ease; }
        .task-card:hover { transform: translateY(-2px); box-shadow: 0 8px 25px rgba(0,0,0,0.15); }
        .completed { background: linear-gradient(135deg, #10b981, #059669); }
        .in-progress { background: linear-gradient(135deg, #f59e0b, #d97706); }
        .not-started { background: linear-gradient(135deg, #6366f1, #4f46e5); }
        .progress-ring { transform: rotate(-90deg); }
        .progress-ring-circle { transition: stroke-dashoffset 0.35s; }
        .category-filter { transition: all 0.3s ease; }
        .category-filter.active { background: linear-gradient(135deg, #8b5cf6, #7c3aed); transform: scale(1.05); }
        * { box-sizing: border-box; }
        .modal-overlay { backdrop-filter: blur(8px); -webkit-backdrop-filter: blur(8px); }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-900 via-indigo-900 to-purple-900 min-h-screen">
    <div id="fontSizeController" class="fixed bottom-4 right-4 z-50 flex items-center space-x-2 bg-white/10 backdrop-blur-lg p-2 rounded-full border border-white/20">
        <button id="decreaseFont" class="w-10 h-10 flex items-center justify-center bg-white/10 text-white rounded-full hover:bg-white/20 transition-colors text-lg font-bold">A-</button>
        <button id="resetFont" class="w-10 h-10 flex items-center justify-center bg-white/10 text-white rounded-full hover:bg-white/20 transition-colors text-sm font-bold">A</button>
        <button id="increaseFont" class="w-10 h-10 flex items-center justify-center bg-white/10 text-white rounded-full hover:bg-white/20 transition-colors text-xl font-bold">A+</button>
    </div>

    <div id="loginScreen" class="min-h-screen px-4 py-8">
        <div class="container mx-auto max-w-6xl">
            <div class="flex justify-center mb-8">
                <div class="bg-white/10 backdrop-blur-lg rounded-2xl p-8 max-w-md w-full border border-white/20">
                    <div class="text-center mb-8">
                        <h1 class="text-4xl font-bold text-white mb-2">ğŸ¢ BNIé›²è²´åˆ†æœƒ</h1>
                        <h2 class="text-2xl font-semibold text-blue-200 mb-4">æ–°æ‰‹æ‘ä»»å‹™ç³»çµ±</h2>
                        <p class="text-lg text-blue-300">è«‹è¼¸å…¥æ‚¨çš„å°ç”Ÿè³‡è¨Š</p>
                        <p class="text-sm text-yellow-300 mt-2">âš ï¸ å°ç”Ÿå¸³è™Ÿç”±å°å¸«å»ºç«‹ï¼Œç„¡æ³•è‡ªè¡Œè¨»å†Š</p>
                    </div>
                    <div id="loginFormContainer">
                        <div class="space-y-4">
                            <div>
                                <label class="block text-white text-base font-medium mb-2">å°ç”Ÿå§“å</label>
                                <input type="text" id="memberName" required class="w-full px-4 py-3 bg-white/10 border border-white/20 rounded-lg text-white placeholder-blue-200 focus:outline-none focus:ring-2 focus:ring-blue-400 text-base" placeholder="è«‹è¼¸å…¥æ‚¨çš„å§“å">
                            </div>
                            <div>
                                <label class="block text-white text-base font-medium mb-2">å°ç”Ÿå¯†ç¢¼</label>
                                <input type="password" id="memberPassword" class="w-full px-4 py-3 bg-white/10 border border-white/20 rounded-lg text-white placeholder-blue-200 focus:outline-none focus:ring-2 focus:ring-blue-400 text-base" placeholder="è«‹è¼¸å…¥å°å¸«ç‚ºæ‚¨è¨­å®šçš„å¯†ç¢¼">
                            </div>
                            <button type="button" id="loginButton" class="w-full bg-gradient-to-r from-blue-600 to-purple-600 text-white py-3 rounded-lg font-semibold hover:from-blue-700 hover:to-purple-700 transition-all text-lg">
                                é–‹å§‹æˆ‘çš„æ–°æ‰‹æ‘ä¹‹æ—…
                            </button>
                        </div>
                    </div>
                    <div class="mt-6 text-center">
                        <button type="button" id="showAdminBtn" class="text-blue-300 hover:text-blue-200 text-sm underline">
                            å°å¸«ç™»å…¥
                        </button>
                    </div>
                </div>
            </div>

            <div class="flex justify-center mb-8">
                 <button type="button" id="toggleGuestFormBtn" class="w-full max-w-md bg-teal-600/50 hover:bg-teal-500/50 text-white py-3 rounded-lg font-semibold transition-all text-lg">
                    ğŸ“ æˆ‘è¦ç™»è¨˜ç‚ºä¾†è³“
                </button>
            </div>
            
            <div id="guestFormContainer" class="hidden">
                <div class="flex justify-center mb-8">
                    <div class="bg-white/10 backdrop-blur-lg rounded-2xl p-8 max-w-md w-full border border-white/20">
                        <h3 class="text-2xl font-semibold text-white mb-6 text-center">ä¾†è³“ç™»è¨˜è¡¨</h3>
                        <div class="space-y-4">
                             <input type="text" id="guestName" required class="w-full px-4 py-3 bg-white/10 border border-white/20 rounded-lg text-white placeholder-blue-200 focus:outline-none focus:ring-2 focus:ring-blue-400" placeholder="æ‚¨çš„å§“å">
                             <input type="text" id="guestProfession" required class="w-full px-4 py-3 bg-white/10 border border-white/20 rounded-lg text-white placeholder-blue-200 focus:outline-none focus:ring-2 focus:ring-blue-400" placeholder="æ‚¨çš„å°ˆæ¥­åˆ¥">
                             <input type="text" id="guestReferrer" required class="w-full px-4 py-3 bg-white/10 border border-white/20 rounded-lg text-white placeholder-blue-200 focus:outline-none focus:ring-2 focus:ring-blue-400" placeholder="ä»‹ç´¹äºº">
                             <select id="guestInterest" class="w-full px-4 py-3 bg-white/10 border border-white/20 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-400">
                                 <option value="é«˜">åŠ å…¥æ„é¡˜åº¦ï¼šé«˜</option>
                                 <option value="ä¸­">åŠ å…¥æ„é¡˜åº¦ï¼šä¸­</option>
                                 <option value="ä½">åŠ å…¥æ„é¡˜åº¦ï¼šä½</option>
                             </select>
                             <button type="button" id="submitGuestBtn" class="w-full bg-gradient-to-r from-teal-500 to-cyan-500 text-white py-3 rounded-lg font-semibold hover:from-teal-600 hover:to-cyan-600 transition-all">
                                 æäº¤ç™»è¨˜
                             </button>
                        </div>
                    </div>
                </div>
            </div>

            <div id="publicGuestListSection" class="mb-8">
                 <div class="bg-white/10 backdrop-blur-lg rounded-2xl p-6 border border-white/20 max-w-4xl mx-auto">
                    <div class="text-center mb-6">
                        <h2 class="text-2xl font-bold text-white mb-2">ğŸ‘‹ æœ€æ–°ä¾†è³“</h2>
                    </div>
                    <div id="publicGuestListContainer" class="space-y-3">
                        </div>
                </div>
            </div>
            <div id="graduatedMembersSection" class="mb-8 hidden">
                <div class="bg-gradient-to-r from-yellow-500/20 to-orange-500/20 backdrop-blur-lg rounded-2xl p-6 border border-yellow-400/30">
                    <div class="text-center mb-6">
                        <h2 class="text-2xl font-bold text-yellow-300 mb-2">ğŸ† å·²å‡ºæ‘å°ç”Ÿè¡¨æš ğŸ†</h2>
                        <p class="text-yellow-200">æ­å–œä»¥ä¸‹å°ç”Ÿå®Œæˆæ‰€æœ‰å¿…ä¿®ä»»å‹™ï¼Œæˆç‚ºBNIå°ˆæ¥­å°ç”Ÿï¼</p>
                    </div>
                    <div id="graduatedMembersList" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"></div>
                </div>
            </div>
            <div id="loginRankingSection" class="hidden">
                <div class="bg-white/10 backdrop-blur-lg rounded-2xl p-6 border border-white/20">
                    <div class="text-center mb-6">
                        <h2 class="text-2xl font-bold text-white mb-2">ğŸ“Š å°ç”Ÿæ’è¡Œæ¦œ</h2>
                        <p class="text-blue-300">æ–°æ‰‹æ‘ä»»å‹™å®Œæˆé€²åº¦æ’å</p>
                    </div>
                    <div id="loginRankingList" class="space-y-3"></div>
                </div>
            </div>
        </div>
    </div>

    <div id="mainContent" class="container mx-auto px-4 py-8 hidden">
        </div>

    <div id="adminLoginScreen" class="min-h-screen items-center justify-center px-4 hidden">
        </div>

    <div id="adminPanelScreen" class="min-h-screen px-4 py-8 hidden">
        </div>
    
    <div id="memberTaskModal" class="fixed inset-0 bg-black/50 modal-overlay hidden items-center justify-center z-50">
        </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        (function() {
            'use strict';
            
            const SUPABASE_URL = 'https://hdssnsnkagfjfbuvgfkn.supabase.co'; 
            const SUPABASE_KEY = 'YOUR_SUPABASE_ANON_KEY'; // â˜…â˜…â˜… è«‹è¨˜å¾—æ›æˆæ‚¨è‡ªå·±çš„ KEY â˜…â˜…â˜…
            const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
            
            // ... (çœç•¥å¤§é‡ JS ç¨‹å¼ç¢¼ï¼Œåƒ…é¡¯ç¤ºä¿®æ”¹è™•) ...
            
            // â˜…â˜…â˜… (ä¿®æ”¹) ä¾†è³“åå–®åŠŸèƒ½ JS START â˜…â˜…â˜…
            // ... (å¾Œå°çš„ showGuestList å‡½å¼ä¸è®Š) ...
            
            async function showPublicGuestList() {
                const container = document.getElementById('publicGuestListContainer');
                if (!container) return;
                container.innerHTML = `<div class="text-white text-center p-4">æ­£åœ¨è¼‰å…¥æœ€æ–°ä¾†è³“...</div>`;
                const { data: guests, error } = await supabaseClient.from('guests').select('id, name, profession, referrer, creator_token').order('created_at', { ascending: false }).limit(10);
                
                if (error) {
                    container.innerHTML = `<div class="text-red-400 text-center p-4">ç„¡æ³•è¼‰å…¥ä¾†è³“åˆ—è¡¨</div>`;
                    return;
                }
                if (guests.length === 0) {
                    container.innerHTML = `<div class="text-center text-blue-300 py-4">ç›®å‰é‚„æ²’æœ‰ä¾†è³“ç™»è¨˜</div>`;
                    return;
                }

                const creatorToken = sessionStorage.getItem('guestCreatorToken');

                container.innerHTML = guests.map(guest => {
                    const deleteButton = (creatorToken && guest.creator_token === creatorToken)
                        ? `<button onclick="deleteGuest(${guest.id}, '${guest.name}')" class="text-red-400 hover:text-red-300 text-xl font-bold">&times;</button>`
                        : '';

                    return `
                    <div class="bg-white/5 rounded-lg p-3 flex items-center justify-between">
                        <div>
                            <p class="text-white font-semibold">${guest.name} <span class="text-sm font-normal text-gray-300">- ${guest.profession}</span></p>
                            <p class="text-xs text-blue-200">ä»‹ç´¹äºº: ${guest.referrer}</p>
                        </div>
                        ${deleteButton}
                    </div>`;
                }).join('');
            }

            async function addGuest() {
                const name = document.getElementById('guestName').value.trim();
                const profession = document.getElementById('guestProfession').value.trim();
                const referrer = document.getElementById('guestReferrer').value.trim();
                const interest_level = document.getElementById('guestInterest').value;

                if (!name || !profession || !referrer) {
                    alert('å§“åã€å°ˆæ¥­åˆ¥å’Œä»‹ç´¹äººç‚ºå¿…å¡«é …ç›®ã€‚');
                    return;
                }
                
                let creatorToken = sessionStorage.getItem('guestCreatorToken');
                if (!creatorToken) {
                    creatorToken = Date.now().toString(36) + Math.random().toString(36).substring(2);
                    sessionStorage.setItem('guestCreatorToken', creatorToken);
                }

                const { error } = await supabaseClient.from('guests').insert({ name, profession, referrer, interest_level, creator_token: creatorToken });
                
                if (error) {
                    alert('ç™»è¨˜å¤±æ•—ï¼š' + error.message);
                } else {
                    alert('æ„Ÿè¬æ‚¨çš„ç™»è¨˜ï¼');
                    document.getElementById('guestName').value = '';
                    document.getElementById('guestProfession').value = '';
                    document.getElementById('guestReferrer').value = '';
                    showPublicGuestList();
                }
            }
            
            async function deleteGuest(guestId, guestName) {
                // å®‰å…¨æ€§æª¢æŸ¥ï¼šå¾è³‡æ–™åº«å†æ¬¡ç¢ºèª token
                const creatorToken = sessionStorage.getItem('guestCreatorToken');
                if (!creatorToken) return alert('ç„¡æ³•é©—è­‰æ‚¨çš„èº«åˆ†ï¼Œç„¡æ³•åˆªé™¤ã€‚');

                const { data: guest, error: fetchError } = await supabaseClient.from('guests').select('creator_token').eq('id', guestId).single();

                if (fetchError || !guest || guest.creator_token !== creatorToken) {
                    return alert('æ¬Šé™ä¸è¶³ï¼Œæ‚¨åªèƒ½åˆªé™¤è‡ªå·±æ–°å¢çš„ä¾†è³“è³‡æ–™ã€‚');
                }

                if (confirm(`ç¢ºå®šè¦åˆªé™¤ä¾†è³“ ${guestName} çš„è³‡æ–™å—ï¼Ÿ`)) {
                     const { error } = await supabaseClient.from('guests').delete().eq('id', guestId);
                    if (error) {
                        alert('åˆªé™¤å¤±æ•—ï¼š' + error.message);
                    } else {
                        alert('åˆªé™¤æˆåŠŸï¼');
                        showPublicGuestList();
                        if (!document.getElementById('adminPanelScreen').classList.contains('hidden')) {
                            showGuestList();
                        }
                    }
                }
            }
            window.deleteGuest = deleteGuest;

            // ... (promoteGuestToMember å‡½å¼ä¸è®Š) ...
            // â˜…â˜…â˜… (ä¿®æ”¹) ä¾†è³“åå–®åŠŸèƒ½ JS END â˜…â˜…â˜…

            
            document.addEventListener('DOMContentLoaded', function() {
                // ... (çœç•¥å¤§éƒ¨åˆ†æœªä¿®æ”¹çš„äº‹ä»¶ç›£è½) ...

                // â˜…â˜…â˜… (ä¿®æ”¹) ä¾†è³“åå–®åŠŸèƒ½ äº‹ä»¶ç›£è½ START â˜…â˜…â˜…
                document.getElementById('toggleGuestFormBtn')?.addEventListener('click', () => {
                    document.getElementById('guestFormContainer').classList.toggle('hidden');
                });
                document.getElementById('submitGuestBtn')?.addEventListener('click', addGuest);
                document.getElementById('showGuestListBtn')?.addEventListener('click', showGuestList);
                // â˜…â˜…â˜… (ä¿®æ”¹) ä¾†è³“åå–®åŠŸèƒ½ äº‹ä»¶ç›£è½ END â˜…â˜…â˜…

                // ... (çœç•¥å…¶ä»–äº‹ä»¶ç›£è½) ...
                
                checkSession();
                showLoginRanking();
                showPublicGuestList(); // é é¢è¼‰å…¥æ™‚å°±é¡¯ç¤ºå…¬é–‹ä¾†è³“åˆ—è¡¨
            });

        })();
    </script>
</body>
</html>
